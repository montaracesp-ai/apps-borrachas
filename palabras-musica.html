<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palabras MÃºsica</title>

    <!-- Archivo de estilos externo -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="palabras-musica">

    <img src="banner.png" alt="Banner" class="banner">

    <div class="card">
        <h1 id="palabra">Cargando...</h1>
    </div>

    <button id="btnCambiar">Cambiar palabra</button>
    <button id="btnVolver" class="btn-volver">Volver atrÃ¡s</button>

    <button id="btnMute" class="btn-mute" title="Mutear/Desmutear">ðŸ”Š</button>

    <script>
        let palabras = [];
        let indice = -1;
        let muted = false;
        const sonido = new Audio('./SONIDOS/siguiente-palabra.mp3');
        const riser = new Audio('./SONIDOS/riser.mp3');

        // Cargar el CSV del servidor
        async function cargarCSV() {
            try {
                const resp = await fetch("./CSV/palabras-musica.csv");
                const texto = await resp.text();

                palabras = texto
                    .split("\n")
                    .map(p => p.trim())
                    .filter(p => p.length > 0);

                mostrarPalabraInicial();
            } catch (err) {
                document.getElementById("palabra").textContent = "Error cargando CSV";
            }
        }

        function mostrarPalabraInicial() {
            indice = Math.floor(Math.random() * palabras.length);
            document.getElementById("palabra").textContent = palabras[indice];
            if (!muted) {
                sonido.play().catch(err => console.log('Error reproduciendo sonido:', err));
            }
        }

        function cambiarPalabra() {
            // Reproducir sonido riser al hacer clic
            if (!muted) {
                riser.currentTime = 0;
                riser.play().catch(err => console.log('Error reproduciendo riser:', err));
            }

            const card = document.querySelector(".card");
            card.classList.add("vibrando");

            // Cambiar palabra despuÃ©s de 2 segundos
            setTimeout(() => {
                card.classList.remove("vibrando");

                let nuevoIndice;
                do {
                    nuevoIndice = Math.floor(Math.random() * palabras.length);
                } while (nuevoIndice === indice);

                indice = nuevoIndice;

                document.getElementById("palabra").textContent = palabras[indice];
                if (!muted) {
                    sonido.currentTime = 0;
                    sonido.play().catch(err => console.log('Error reproduciendo sonido:', err));
                }
            }, 2000);
        }

        function toggleMute() {
            muted = !muted;
            const btnMute = document.getElementById("btnMute");
            btnMute.textContent = muted ? "ðŸ”‡" : "ðŸ”Š";
        }

        function volverAtras() {
            window.location.href = 'index.html';
        }

        document.getElementById("btnCambiar").addEventListener("click", cambiarPalabra);
        document.getElementById("btnVolver").addEventListener("click", volverAtras);
        document.getElementById("btnMute").addEventListener("click", toggleMute);

        // Iniciar carga del CSV
        cargarCSV();
    </script>

</body>

</html>